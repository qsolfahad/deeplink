<!DOCTYPE html>
<html>
  <head>
    <script
      src="https://test-bankalfalah.gateway.mastercard.com/static/checkout/checkout.min.js"
      
    ></script>

    <script type="text/javascript">
      let checkoutConfigured = false;
        
      async function initializeCheckout() {
        try {
          // const response = await fetch("https://deeplink-drab.vercel.app/create-session", {
          const response = await fetch("http://localhost:3000/create-session", {
            method: "POST",
          });
          const data = await response.json();

          console.log("Session Data:", data);

          Checkout.configure({
            session: {
              id: data.session.id,
            },
          
          });

          checkoutConfigured = true;
          document.getElementById("embeddedBtn").disabled = false;
          document.getElementById("paymentPageBtn").disabled = false;
          document.getElementById("refundBtn").disabled = false;
        } catch (error) {
          console.error("Error initializing checkout:", error);
        }
      }

      function errorCallback(error) {
        console.log("Checkout Error:", JSON.stringify(error));
      }

      function cancelCallback() {
        console.log("Payment cancelled");
      }

      function showEmbeddedPage() {
        if (!checkoutConfigured) {
          console.error("Checkout not configured yet!");
          return;
        }
        Checkout.showEmbeddedPage("#embed-target");
      }

      function showPaymentPage() {
        if (!checkoutConfigured) {
          console.error("Checkout not configured yet!");
          return;
        }
        Checkout.showPaymentPage();
      }

      function showRefund() {
        const refundForm = document.getElementById('refundForm');
        refundForm.style.display = 'block';
      }

      async function submitRefund(event) {
        event.preventDefault();
        const orderId = document.getElementById('orderId').value;
        // const transactionId = document.getElementById('transactionId').value;
        const amount = document.getElementById('amount').value;

        try {
          const response = await fetch("http://localhost:3000/refund", {
            method: "POST",
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({ orderId, amount })
          });
          const data = await response.json();
          alert(data.message || 'Refund request processed');
        } catch (error) {
          console.error("Error processing refund:", error);
          alert('Error processing refund');
        }
      }

      window.onload = initializeCheckout;
    </script>
  </head>

  <body>
    <div id="embed-target"></div>
    <input
      id="embeddedBtn"
      type="button"
      value="Pay with Embedded Page"
      onclick="showEmbeddedPage()"
      disabled
    />
    <input
      id="paymentPageBtn"
      type="button"
      value="Pay with Payment Page"
      onclick="showPaymentPage()"
      disabled
    />
    <input
      id="refundBtn"
      type="button"
      value="Refund Transaction"
      onclick="showRefund()"
      disabled
    />
    <div id="refundForm" style="display: none;">
      <form onsubmit="submitRefund(event)">
        <div>
          <label for="orderId">Order ID:</label>
          <input type="text" id="orderId" required />
        </div>
        <!-- <div>
          <label for="transactionId">Transaction ID:</label>
          <input type="text" id="transactionId" required />
        </div> -->
        <div>
          <label for="amount">Amount:</label>
          <input type="number" id="amount" required />
        </div>
        <button type="submit">Process Refund</button>
      </form>
    </div>
  </body>
</html>
